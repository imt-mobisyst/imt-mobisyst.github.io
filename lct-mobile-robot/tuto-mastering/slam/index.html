<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>S.L.A.M - Lct. Mobile-Robot</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../style.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "S.L.A.M";
        var mkdocs_page_input_path = "tuto-mastering/slam.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Lct. Mobile-Robot
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="" href="../../..">MobiSyst <</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Intro</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Kick-off</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../tuto-kick-off/basics/">OS and Shell</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tuto-kick-off/first-contact/">Nodes and Topics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tuto-kick-off/package/">ROS Package</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tuto-kick-off/move/">Move the Robot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tuto-kick-off/simulation/">Simulation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Level-up</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../tuto-level-up/range-sensor/">Range Sensor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tuto-level-up/reactive/">Reactive Move</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tuto-level-up/parameters/">Parameters</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tuto-level-up/camera-driver/">Camera Driver</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tuto-level-up/vision/">Vision</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Mastering</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">S.L.A.M</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../vision/">Image processing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../transform/">Move To</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Challenge</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../challenge/kick-off/">Kick-off</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../challenge/challenge-1on2/">Challenge 1</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../challenge/challenge-2on2/">Challenge 2</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendix</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../appendix/installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../appendix/faq/">F.A.Q</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../pdf/"></a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Lct. Mobile-Robot</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Mastering</li>
      <li class="breadcrumb-item active">S.L.A.M</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="what-is-slam-in-a-nutshell">What is SLAM in a Nutshell?</h1>
<p>Mobile robots rely heavily on accurate representations of the environment (i.e <em>maps</em>) to fulfill their tasks (autonomous navigation, exploration, ...). Inside buildings, GPS signals are too weak to be used to localize robots. Hence we face a so-called Chicken-and-Egg-Problem, as <em>localization</em> requires a map, and map building (i.e. <em>mapping</em>) requires the current location.
One solution consists in doing <em>Simultaneous Localization and Mapping</em> (a.k.a. SLAM) using a SLAM algorithm that typically reaches centimetric precision.</p>
<p>There are many different flavors of SLAM especially regarding the map format. The dominating 2D map format is the occupancy grid, also called grid map. A grid map is a matrix whose cells represents a defined region of the real world; this is the <em>resolution</em> of the grid map (typically a square of 5cm). A cell holds the estimated probability that the space it represents is traversable (free space) or not (obstacle). The simplest format is the 3-state occupancy grid in which a cell has 3 different possible values: 0 (free space), 0.5 (unknown) and 1 (obstacle).</p>
<p><img alt="Overview of a SLAM algorithm that produces a 3-state occupancy grid map and the robot pose (i.e. the robot position and its orientation)" src="../../files/SLAM/SLAMGridMaps.jpg" /></p>
<!-- Localization
- Dead Reckoning
- Particle Filters
- Kalman Filters
- Pose Graph Optimization
- Scan matching -->

<p><a href="https://navigation.ros.org/setup_guides/transformation/setup_transforms.html">Transformations doc</a></p>
<h2 id="map-building-using-slam_toolbox">Map building using <code>slam_toolbox</code></h2>
<p>There are a lot of different SLAM algorithms and some implementations are open source and available on <a href="https://openslam-org.github.io/">OpenSLAM</a>.</p>
<p>We will use here the <a href="https://github.com/SteveMacenski/slam_toolbox"><code>slam_toolbox</code></a> ROS implementation (documentation is <a href="https://navigation.ros.org/tutorials/docs/navigation2_with_slam.html">here</a>).</p>
<h3 id="launch-slam_toolbox">Launch <code>slam_toolbox</code></h3>
<pre><code class="language-console">ros2 launch tbot_sim challenge-1.launch.py
</code></pre>
<pre><code class="language-console">ros2 launch slam_toolbox online_sync_launch.py --ros-args -p use_sim_time:=True
</code></pre>
<pre><code class="language-console">rviz2 --ros-args -p use_sim_time:=True
</code></pre>
<blockquote>
<p>Question: using all the tools you already know (<code>rviz2</code>, <code>rqt_graph</code>, tf, ...), what are the input and output data of <code>slam_toolbox</code>?</p>
</blockquote>
<h3 id="manual-mapping">Manual Mapping</h3>
<p>Launch a teleop:</p>
<pre><code class="language-console"># keyboard
ros2 run teleop_twist_keyboard teleop_twist_keyboard

# or xbox
ros2 launch teleop_twist_joy teleop-launch.py joy_config:=xbox
</code></pre>
<p>Now, while moving the robot around the simulated environment, you should see the result of <code>slam_toolbox</code> (both the map and robot pose) updated in <code>rviz2</code>.</p>
<!-- ![GMapping demo rqt_graph](../files/SLAM/gmapping_stage_rqt_graph.png) -->

<p><img alt="tf tree" src="../../files/SLAM/frames_slam.png" /></p>
<p>It is possible to save the map by using slam_toolbox service call:</p>
<pre><code class="language-console">ros2 service call /slam_toolbox/save_map slam_toolbox/srv/SaveMap &quot;name: {data: '/home/user.name/path/to/map'}&quot;
</code></pre>
<!--
# Autonomous Navigation sending goal points

> Facultative part


<pre><code>ros2 launch nav2_bringup navigation_launch.py
</code></pre>


Be carreful, navigation should publish in the right topic so that the robot receive command velocities.
Then, send goal points into `/goal_pose` (use rviz2)

# Save the Map


<pre><code class="language-console">ros2 run nav2_map_server map_saver_cli -f /home/bot/map
</code></pre>


> Sometimes this command produces a timeout. This is because it listens to the `map` topic no map is received during a certain amount of time and we cannot extend this delay...

Another solution to save the map is to use the following service call:


<pre><code class="language-console">ros2 service call /slam_toolbox/save_map slam_toolbox/srv/SaveMap &quot;name: {data: '/home/bot/map2'}&quot;
</code></pre>


<!-- # All in one

Stop everything.


<pre><code>ros2 launch nav2_bringup slam_launch.py
</code></pre>


Then, map can be saved using:


<pre><code>
</code></pre>


-->

<h2 id="load-a-map-and-localize-in-it">Load a map and Localize in it</h2>
<p>To load a map and localize in it, you should:</p>
<ol>
<li>execute:</li>
</ol>
<pre><code>ros2 launch nav2_bringup localization_launch.py map:=/home/bot/map.yaml autostart:=True
</code></pre>
<ol>
<li>
<p>publish an approximate initial pose into the topic <code>/initialpose</code> (using rviz2 for example)</p>
</li>
<li>
<p>move the robot around (teleop or so) to improve the acuracy of the localization</p>
</li>
</ol>
<p><strong>In simulation</strong>, we do the same steps, but the time is simulated:</p>
<pre><code>ros2 launch nav2_bringup localization_launch.py map:=/home/bot/map.yaml autostart:=True use_sim_time:=True

rviz2 --ros-args --remap use_sim_time:=True
</code></pre>
<h2 id="bag-files-ros2-bag">Bag files (<code>ros2 bag</code>)</h2>
<p>Working in simulation is nice but we can do better and work directly on real data using the <code>ros2 bag</code> command tool.
The idea is to record some topics (all data that goes through) into a <a href="http://wiki.ros.org/Bags">bag file</a> and play them later on.
Bag files are really useful to test algorithms on real data sets that have been recorded in a specific location and with  specific sensors.
Moreover, there are a lot of public datasets available:</p>
<ul>
<li>[http://radish.sourceforge.net/]</li>
<li>[https://vision.in.tum.de/data/datasets/rgbd-dataset/download]</li>
<li>[http://www.ipb.uni-bonn.de/datasets/]</li>
<li>[http://car.imt-lille-douai.fr/polyslam/]</li>
</ul>
<p>Use the <a href="https://docs.ros.org/en/iron/Tutorials/Beginner-CLI-Tools/Recording-And-Playing-Back-Data/Recording-And-Playing-Back-Data.html">tutorial on rosbag</a> to learn how to use it.</p>
<blockquote>
<p>Work: Launch the challenge 2 simulation, record <code>/tf</code> and <code>/scan</code> into a rosbag and teleop the robot all around the map. You now have a dataset ready to do offline SLAM.</p>
</blockquote>
<h2 id="offline-mapping">Offline Mapping</h2>
<blockquote>
<p>Work: Play the rosbag created before and launch <code>slam_toolbox</code> in offline mode to create the map and then save it. You can now load this map to localize the robot into it.</p>
</blockquote>
<h2 id="map-a-real-arena">Map a real arena</h2>
<p>Re-do exactly the same things to map an existing arena:</p>
<ol>
<li>Put the robot inside the arena</li>
<li>Record a bag file with all needed data to achieve SLAM</li>
<li>Manually teleoperate the robot everywhere in the arena</li>
<li>Save the bag file</li>
<li>Play the bag file and launch the SLAM to create a map and save it (offline mapping)</li>
<li>Put the robot inside the arena and load the map to localize the robot inside the arena</li>
</ol>
<blockquote>
<p>Hint: <code>slam_toolbox</code> comes with a RViz plugin (Panels-&gt;Add New Panel-&gt;slam_toolbox-&gt;SlamToolboxPlugin) that might help</p>
</blockquote>
<h2 id="tuning-map-quality">Tuning map quality</h2>
<p>SLAM algorithms usually have a lot of parameters that can be tuned to improve performance or map quality.
<code>slam_toolbox</code> is no exception. Some hints <a href="https://www.robotandchisel.com/2020/08/19/slam-in-ros2/">here</a>.</p>
<!-- Comparing resulting maps and localization:
- cite Sang's paper
- Python package for the evaluation of odometry and SLAM
https://michaelgrupp.github.io/evo/ -->
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../tuto-level-up/vision/" class="btn btn-neutral float-left" title="Vision"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../vision/" class="btn btn-neutral float-right" title="Image processing">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../tuto-level-up/vision/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../vision/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../javascripts/mathjax.js"></script>
      <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
